---
import Layout from '../../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const allPosts = await getCollection('blog');
  
  const postsByYear = allPosts.reduce((acc, post) => {
    const year = new Date(post.data.date).getFullYear();
    if (!acc[year]) acc[year] = [];
    acc[year].push(post);
    return acc;
  }, {} as Record<number, typeof allPosts>);

  return Object.keys(postsByYear).map(year => ({
    params: { year },
    props: { 
      posts: postsByYear[Number(year)].sort((a, b) => 
        new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
      )
    },
  }));
}

const { year } = Astro.params;
const { posts } = Astro.props;
---

<Layout title={`Blog ${year}`}>
  <h1>Blog Posts - {year}</h1>
  
  <ul class="posts-list">
    {posts.map(post => (
      <li>
        <a href={`/blog/${year}/${post.slug}`}>
          <h2>{post.data.title}</h2>
          <time datetime={post.data.date}>{post.data.date}</time>
          {post.data.description && <p>{post.data.description}</p>}
        </a>
      </li>
    ))}
  </ul>
  
  <a href="/">‚Üê Home</a>
</Layout>

<style>
  .posts-list {
    list-style: none;
    padding: 0;
    margin: 2rem 0;
  }

  .posts-list li {
    margin: 2rem 0;
  }

  .posts-list a {
    color: inherit;
    text-decoration: none;
  }

  .posts-list a:hover {
    text-decoration: underline;
  }

  .posts-list h2 {
    margin-bottom: 0.5rem;
  }

  time {
    color: #666;
    font-size: 0.9rem;
  }

  .posts-list p {
    margin-top: 0.5rem;
    color: #555;
  }
</style>
