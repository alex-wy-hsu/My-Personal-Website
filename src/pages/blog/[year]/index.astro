---
import Layout from '../../../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import { groupPostsByYear, latestYear, sortPostsByDateDesc } from '../../../lib/posts';
import { toChineseUpperYear, accentVar } from '../../../lib/year';

export async function getStaticPaths() {
	const posts = await getCollection('blog');
	const grouped = groupPostsByYear(posts);
	const navYear = latestYear(posts);
	return grouped.map(({ year, posts }) => ({
		params: { year: year.toString() },
		props: { year, posts, navYear },
	}));
}

const { year, posts, navYear } = Astro.props;
const sorted = sortPostsByDateDesc(posts);
---

<Layout title={`Blog ${year} | Minimal Astro`} navLatestYear={navYear}>
	<div style="display: flex; align-items: baseline; gap: 0.75rem;">
		<h1 style="margin: 0;">Blog {year}</h1>
		<span class="badge-large" style={`font-size: 1.35rem; color: ${accentVar(year)};`}>{toChineseUpperYear(year)}</span>
	</div>
	{sorted.length === 0 ? (
		<p>No posts for this year.</p>
	) : (
		<ul class="card-list">
			{sorted.map((post) => (
				<li>
					<a class="card-row" href={`/blog/${year}/${post.slug.split('/').pop()}`}>
						<div style="display: grid; gap: 0.2rem;">
							<div style="font-weight: 700;">{post.data.title}</div>
							<div class="post-list-meta">{post.data.date.toISOString().slice(0, 10)}</div>
							{post.data.description && <div class="post-list-meta">{post.data.description}</div>}
						</div>
					</a>
				</li>
			))}
		</ul>
	)}
</Layout>