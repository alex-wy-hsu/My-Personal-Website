---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import { groupPostsByYear, latestYear } from '../lib/posts';
import { toChineseUpperYear, accentVar } from '../lib/year';

const posts = await getCollection('blog');
const grouped = groupPostsByYear(posts);
const navYear = latestYear(posts);
---

<Layout title="Home | Minimal Astro" navLatestYear={navYear}>
	<h1>Blog Years</h1>
	{grouped.length === 0 ? (
		<p>No posts yet.</p>
	) : (
		<ul class="card-list">
			{grouped.map(({ year, posts }) => (
				<li>
					<a class="card-row" href={`/blog/${year}`}>
						<div style="display: grid; gap: 0.1rem; min-width: 6.5rem;">
							<span class="badge-large" style={`color: ${accentVar(year)};`}>{toChineseUpperYear(year)}</span>
							<span class="badge-small muted">{year}</span>
						</div>
						<div style="display: grid; gap: 0.25rem;">
							<span style="font-weight: 700;">{posts.length} post{posts.length > 1 ? 's' : ''}</span>
							<span class="muted" style="font-size: 0.95rem;">Browse posts from {year}.</span>
						</div>
					</a>
				</li>
			))}
		</ul>
	)}
</Layout>
